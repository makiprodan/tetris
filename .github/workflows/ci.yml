name: ğŸš€ CI/CD Pipeline

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  test:
    name: ğŸ§ª Testes e ValidaÃ§Ã£o
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout cÃ³digo
      uses: actions/checkout@v4
      
    - name: ğŸ” Verificar estrutura de arquivos
      run: |
        echo "ğŸ” Verificando arquivos essenciais..."
        test -f index.html || (echo "âŒ index.html nÃ£o encontrado" && exit 1)
        test -f style.css || (echo "âŒ style.css nÃ£o encontrado" && exit 1)
        test -f script.js || (echo "âŒ script.js nÃ£o encontrado" && exit 1)
        test -f README.md || (echo "âŒ README.md nÃ£o encontrado" && exit 1)
        test -f LICENSE || (echo "âŒ LICENSE nÃ£o encontrado" && exit 1)
        echo "âœ… Todos os arquivos essenciais encontrados!"
        
    - name: ğŸ¯ Validar HTML
      run: |
        echo "ğŸ¯ Validando estrutura HTML..."
        grep -q "<!DOCTYPE html>" index.html || (echo "âŒ DOCTYPE nÃ£o encontrado" && exit 1)
        grep -q "<title>" index.html || (echo "âŒ Title nÃ£o encontrado" && exit 1)
        grep -q "viewport" index.html || (echo "âŒ Viewport meta tag nÃ£o encontrada" && exit 1)
        echo "âœ… HTML vÃ¡lido!"
        
    - name: ğŸ¨ Verificar CSS
      run: |
        echo "ğŸ¨ Verificando CSS..."
        test -s style.css || (echo "âŒ style.css estÃ¡ vazio" && exit 1)
        echo "âœ… CSS presente!"
        
    - name: ğŸ”§ Verificar JavaScript
      run: |
        echo "ğŸ”§ Verificando JavaScript..."
        test -s script.js || (echo "âŒ script.js estÃ¡ vazio" && exit 1)
        # Verificar sintaxe bÃ¡sica
        node -c script.js || (echo "âŒ Erro de sintaxe em script.js" && exit 1)
        echo "âœ… JavaScript vÃ¡lido!"
        
    - name: ğŸ“± Verificar responsividade
      run: |
        echo "ğŸ“± Verificando meta tags de responsividade..."
        grep -q "viewport" index.html || (echo "âŒ Meta viewport nÃ£o encontrada" && exit 1)
        echo "âœ… Meta tags de responsividade presentes!"
        
    - name: ğŸ“š Verificar documentaÃ§Ã£o
      run: |
        echo "ğŸ“š Verificando documentaÃ§Ã£o..."
        grep -q "Tetris" README.md || (echo "âŒ README.md nÃ£o menciona Tetris" && exit 1)
        grep -q "## " README.md || (echo "âŒ README.md sem seÃ§Ãµes" && exit 1)
        echo "âœ… DocumentaÃ§Ã£o adequada!"

  deploy:
    name: ğŸŒ Deploy GitHub Pages
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/master' && github.event_name == 'push'
    
    steps:
    - name: ğŸ“¥ Checkout cÃ³digo
      uses: actions/checkout@v4
      
    - name: ğŸš€ Deploy para GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./
        
    - name: âœ… ConfirmaÃ§Ã£o de deploy
      run: |
        echo "ğŸ‰ Deploy realizado com sucesso!"
        echo "ğŸŒ Site disponÃ­vel em: https://${{ github.repository_owner }}.github.io/tetris"